= Sequences

You can combine actions into sequences and invoke them as a single action. Therefore, a sequence represents a logical junction between two or more actions, where each action is invoked in a specific order.

== Example: making a pizza

Suppose we want to describe an algorithm to prepare a pizza. We could prepare everything in a single action, creating something like this:

[source, javascript]
----
// file: pizza.js
function main(args) {

    let persons = args.howManyPerson;
    let whichPizza = args.pizza;

    let flour = persons * 180; // grams
    let water = persons * 120; // ml

    let pizzaDough = preparePizzaDough(flour, water);
    
    let cookedPizza = cookPizza(pizzaDough, whichPizza);

    return { "result": cookedPizza };
}

function preparePizzaDough(flour, water) {
    let yeast = (flour + water) * 0.02; 

    const sixHours = 6 * 60 * 60 * 1000;

    return new Promise((resolve, reject) => {
        setTimeout(() => {
            resolve("Mix " + flour + " grams of flour with " + water + " ml of water and add " + yeast + " grams of brewer's yeast");
        }, sixHours);
    });
}

function cookPizza(pizzaDough, whichPizza) {
    let baseIngredients = "Tomato, mozzarella";
    if (whichPizza === "Margherita") {
        return "Cook " + pizzaDough + " topped with " + baseIngredients + " for 3 minutes at 380°C";
    } else if (whichPizza === "Sausage") {
        baseIngredients += ", sausage";
        return "Cook " + pizzaDough + " topped with " + baseIngredients + ". Cook for 3 minutes at 380°C";
    }     
}
----

With the command:

[source, bash]
----
nuv action invoke pizza/pizza -p howManyPerson 4 -p pizza "Margherita"
----

it will return:

[source, json]
----
"result": {
    "result": "Cook Mix 720 grams of flour with 480 ml of water and add 24 grams of brewer's yeast topped with Tomato, mozzarella for 3 minutes at 380°C"
}
----



We can now create a sequence combining the `hello` action with the `b64` action:

-----
$  nuv action create demo/seq --sequence demo/hello,demo/b64
ok: created action demo/seq
$ nuv invoke demo/seq
{
  "body": "SGVsbG8="
}
-----


Let's verify the output of the sequence:

-----
$ echo SGVsbG8= | base64 -d
Hello
-----
